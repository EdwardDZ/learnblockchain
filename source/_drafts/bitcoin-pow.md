---
title:  比特币如何挖矿-工作量证明
date: 2017-11-04 16:12:29
categories: Bitcoin
tags:
    - 比特币
    - 挖矿
    - 工作量证明

author: Tiny熊
---

在{% post_link whatbc 区块链记账原理 %} 我们了解到记账是把交易记录，交易时间，账本序号、上一个Hash值等信息计算Hash打包的过程，我们知道所有的计算和存贮是需要消耗计算机资源的，既然要付出成本，那节点为什么还要参与记账呢？在中本聪（比特币之父）的设计里，完成记账的节点可以获得系统给与一定数量的比特币奖励，这个奖励的过程也是比特币的发行过程，因此大家形象的把记账称为“挖矿”，本文将详细讨论这个过程。

## 记账工作

由于记账是有奖励的，当前每次记账可以给自己凭空增加一定数量的个比特币（当前是12.5币，貌似现在每个币是4万人民币以上，大家可以算算多少钱），因此就出穿线大家会争相记账，大家一起记账就会引起新的问题：出现记账不一致的问题，比特币系统引入工作量证明来解决这个问题，规则如下：

* 一段时间内（10分钟左右，具体时间会与密码学难题难度相互影响）只有一人可以记账成功
* 通过解决密码学难题（即工作量证明）竞争获得唯一记账权
* 其他节点复制记账结果

不过在进行工作量证明之前，记账节点会做进行如下准备工作：
* 收集广播中还没有被记录账本的原始交易信息
* 检查每个交易信息中付款地址有没有足够的余额
* 验证交易是否有正确的签名
* 把验证通过的交易信息进行打包记录
* 添加一个奖励交易：给自己的地址增加12.5btc 

如果节点争夺记账权成功的话，就可以得到12.5btc的奖励。

## 工作量证明
{% post_link whatbc 区块链记账原理 %}我们了解到，每次记账的时候回把上一个块的Hash值和当前的账页信息一起作为原始信息进行Hash。
如果是这样，显然每个人都可以记账。
为了保证10分钟左右只有一个人可以记账，就必须要提高记账的难度，使得Hash的结果必须以若干个0开头。同是为了满足这个条件，在进行Hash时引入一个随机数变量。

用伪代码表示一下：

```python
# 没有难度时为：Hash(上一个Hash值，交易记录集) = 456635BCD
Hash(上一个Hash值，交易记录集，随机数) = 0000aFD635BCD
```
我们知道改变Hash的原始信息的任何一部分，Hash值也会随之不断的变化，因此在运算Hash时，不断的改变随机数的值，总可以找的一个值使的Hash的结果以若干个0开头，率先找到随机数就获得唯一记账权。

### 工作量分析
我们简单分析下记账难度有多大，
Hash值是由数字和大小写字母构成的字符串，每一位有62种可能性（可能为26个大写字母、26个小写字母，10个数字中任一个），假定取任何一个字符的可能性是均等的，那么第一位为0的概率是1/62（不管后面的数字），也即需要尝试62次Hash运算才可以找到，如果前两2位为0，就尝试62的平方次Hash运算，n个0需要尝试62的n次方次。我们当前实际区块#493050信息，来看看：

![区块#493050](/images/block_info_493050.jpg)

注：数据来源于https://blockchain.info
我们可以看到Hash值以18个0开头，理论上需要尝试62的18次方次，这个数是非常巨大的，另外，我们在图中还可以看到找到符合要求的Hash对应的随机数和奖励。




18个0



62 个可能 
1/62  * 1/62 = 



 


这时





比特币作为一个分布式账本，

谁可以记账，
谁愿意记账，
记得不一样怎么办，



